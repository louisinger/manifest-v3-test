"use strict";function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var e=require("liquidjs-lib"),r=require("liquidjs-lib/src/psbt"),n=require("bip39"),i=t(require("bs58check")),o=t(require("bip32")),a=require("slip77"),s=t(require("ecpair")),u=t(require("axios"));function c(t){var e,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(e=t[r]))return e.call(t);if(n&&null!=(e=t[n]))return new p(e.call(t));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function p(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return(p=function(t){this.s=t,this.n=t.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var r=this.s.return;return void 0===r?Promise.resolve({value:t,done:!0}):e(r.apply(this.s,arguments))},throw:function(t){var r=this.s.return;return void 0===r?Promise.reject(t):e(r.apply(this.s,arguments))}},new p(t)}function f(t){this.wrapped=t}function l(t){var e,r;function n(e,r){try{var o=t[e](r),a=o.value,s=a instanceof f;Promise.resolve(s?a.wrapped:a).then((function(t){s?n("return"===e?"return":"next",t):i(o.done?"return":"normal",t)}),(function(t){n("throw",t)}))}catch(t){i("throw",t)}}function i(t,i){switch(t){case"return":e.resolve({value:i,done:!0});break;case"throw":e.reject(i);break;default:e.resolve({value:i,done:!1})}(e=e.next)?n(e.key,e.arg):r=null}this._invoke=function(t,i){return new Promise((function(o,a){var s={key:t,arg:i,resolve:o,reject:a,next:null};r?r=r.next=s:(e=r=s,n(t,i))}))},"function"!=typeof t.return&&(this.return=void 0)}function d(t){return function(){return new l(t.apply(this,arguments))}}function h(t){return new f(t)}function v(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function x(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function a(t){v(o,n,i,a,s,"next",t)}function s(t){v(o,n,i,a,s,"throw",t)}a(void 0)}))}}function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function b(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,w(t,e)}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function w(t,e){return(w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function P(t,e,r){return(P=m()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&w(i,r.prototype),i}).apply(null,arguments)}function E(t){var e="function"==typeof Map?new Map:void 0;return(E=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return P(t,arguments,g(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),w(r,t)})(t)}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return k(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}l.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},l.prototype.next=function(t){return this._invoke("next",t)},l.prototype.throw=function(t){return this._invoke("throw",t)},l.prototype.return=function(t){return this._invoke("return",t)};var A,O=(function(t){var e=function(t){var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=Object.create((e&&e.prototype instanceof f?e:f).prototype),o=new E(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=w(a,r);if(s){if(s===p)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,o),i}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var p={};function f(){}function l(){}function d(){}var h={};s(h,i,(function(){return this}));var v=Object.getPrototypeOf,x=v&&v(v(k([])));x&&x!==e&&r.call(x,i)&&(h=x);var y=d.prototype=f.prototype=Object.create(h);function b(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function g(t,e){var n;this._invoke=function(i,o){function a(){return new e((function(n,a){!function n(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var p=u.arg,f=p.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(f).then((function(t){p.value=t,a(p)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function w(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,p;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,p):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function m(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(m,this),this.reset(!0)}function k(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return l.prototype=d,s(y,"constructor",d),s(d,"constructor",l),l.displayName=s(d,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},b(g.prototype),s(g.prototype,o,(function(){return this})),t.AsyncIterator=g,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new g(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(y),s(y,a,"Generator"),s(y,i,(function(){return this})),s(y,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=k,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(A={exports:{}}),A.exports),S=Buffer.alloc(32),I=Buffer.from("0x00","hex");function _(t){return null!=t&&t.length>0}function K(t){var e=t.surjectionProof,r=t.nonce;return _(t.rangeProof)&&_(e)&&r!==I}var N=function(){function t(){this.map=new Map}var e=t.prototype;return e.bufferToStringPrimitive=function(t){return t.toString("hex").valueOf()},e.get=function(t){return this.map.get(this.bufferToStringPrimitive(t))},e.set=function(t,e){return this.map.set(this.bufferToStringPrimitive(t),e),this},e.values=function(){return Array.from(this.map.values())},t}(),U=new Map([["xpub","0488b21e"],["ypub","049d7cb2"],["Ypub","0295b43f"],["zpub","04b24746"],["Zpub","02aa7ed3"],["tpub","043587cf"],["upub","044a5262"],["Upub","024289ef"],["vpub","045f1cf6"],["Vpub","02575483"]]);function B(t,e){if(!U.has(e))return"Invalid target version";t=t.trim();try{var r=i.decode(t);return r=r.slice(4),r=Buffer.concat([Buffer.from(U.get(e),"hex"),r]),i.encode(r)}catch(t){throw new Error("Invalid extended public key! Please double check that you didn't accidentally paste extra data.")}}function R(t){return B(t,"xpub")}var L,M=/[a-z]pub[a-km-zA-HJ-NP-Z1-9]{100,108}$/,C=/[0-9a-fA-F]{64}$/;function H(t){return M.test(t)}function D(t){return C.test(t)}function F(t){var r;try{r=e.Psbt.fromBase64(t)}catch(t){throw new Error("Invalid pset")}return r.data.globalMap.unsignedTx.toBuffer().toString("hex")}function j(t){return e.Transaction.fromHex(F(t))}function W(t){return t?e.networks[t]:e.networks.liquid}function G(t,e){return V.apply(this,arguments)}function V(){return(V=x(O.mark((function t(r,n){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(K(r.prevout)){t.next=2;break}return t.abrupt("return",y({},r,{unblindData:{asset:r.prevout.asset.slice(1),value:e.confidential.confidentialValueToSatoshi(r.prevout.value).toString(10),assetBlindingFactor:S,valueBlindingFactor:S}}));case 2:return t.next=4,e.confidential.unblindOutputWithKey(r.prevout,Buffer.from(n,"hex"));case 4:return t.abrupt("return",y({},r,{unblindData:t.sent}));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function X(t,e){if(t!==e)throw new Error("Incorrect Identity type: need "+e+" and get "+t+".")}function q(t,e){if(e&&n.setDefaultWordlist(e),!n.validateMnemonic(t))throw new Error("Mnemonic is not valid.")}function Y(t){var r;try{r=e.Psbt.fromBase64(t)}catch(t){throw new Error("Invalid pset")}return r}function Q(t,e){return t.reduce((function(t,r){var n,i=e(r),o=null!=(n=t[i])?n:[];return t[i]=[].concat(o,[r]),t}),{})}function z(t){return void 0!==t.unblindData}function Z(t){if(z(t))return parseInt(t.unblindData.value,10);if(!K(t.prevout))return e.confidential.confidentialValueToSatoshi(t.prevout.value);throw new Error("cannot get value for confidential output, need unblinded one")}function $(t){if(z(t))return Buffer.from(t.unblindData.asset).reverse().toString("hex");if(!K(t.prevout))return Buffer.from(t.prevout.asset).slice(1).reverse().toString("hex");throw new Error("cannot get asset for confidential output, need unblinded one")}(L=exports.IdentityType||(exports.IdentityType={}))[L.PrivateKey=1]="PrivateKey",L[L.Mnemonic=2]="Mnemonic",L[L.MasterPublicKey=3]="MasterPublicKey",L[L.Inject=4]="Inject",L[L.Ledger=5]="Ledger",L[L.Trezor=6]="Trezor",L[L.MultisigWatchOnly=7]="MultisigWatchOnly",L[L.Multisig=8]="Multisig";var J=function(){function t(t){if(!t.chain||!e.networks.hasOwnProperty(t.chain))throw new Error("Network is missing or not valid");if(!t.type||!(t.type in exports.IdentityType))throw new Error("Type is missing or not valid");this.network=e.networks[t.chain],this.type=t.type,this.ecclib=t.ecclib}return t.prototype.blindPsetWithBlindKeysGetter=function(){var t=x(O.mark((function t(n,i,o,a,s){var u,c,p,f,l,d,h,v,x,y,b,g,w,m,P;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u=new Map,c=new Map,p=Y(i),f=e.Transaction.fromHex(F(i)),l=T(o);case 5:if((d=l()).done){t.next=16;break}if(h=d.value,null==a||!a.has(h)){t.next=11;break}return v=Buffer.from(a.get(h),"hex"),c.set(h,v),t.abrupt("continue",14);case 11:x=n(f.outs[h].script).publicKey,c.set(h,x);case 14:t.next=5;break;case 16:y=0;case 17:if(!(y<p.data.inputs.length)){t.next=43;break}if(g=void 0,!(b=p.data.inputs[y]).witnessUtxo){t.next=24;break}if(K(b.witnessUtxo)){t.next=23;break}return t.abrupt("continue",40);case 23:g=b.witnessUtxo.script;case 24:if(!b.nonWitnessUtxo){t.next=30;break}if(w=f.ins[y].index,K(m=e.Transaction.fromBuffer(b.nonWitnessUtxo).outs[w])){t.next=29;break}return t.abrupt("continue",40);case 29:g=m.script;case 30:if(null==s||!s.has(y)){t.next=33;break}return u.set(y,s.get(y)),t.abrupt("continue",40);case 33:if(g){t.next=35;break}throw new Error("no witness script for input #"+y);case 35:return P=n(g).privateKey,t.next=38,e.confidential.unblindOutputWithKey(b.witnessUtxo,P);case 38:u.set(y,t.sent);case 40:y++,t.next=17;break;case 43:return t.next=45,p.blindOutputsByIndex(r.Psbt.ECCKeysGenerator(this.ecclib),u,c);case 45:return t.abrupt("return",t.sent.toBase64());case 47:case"end":return t.stop()}}),t,this)})));return function(e,r,n,i,o){return t.apply(this,arguments)}}(),t}(),tt=function(t){function r(e){var n;if((n=t.call(this,e)||this).index=r.INITIAL_INDEX,n.changeIndex=r.INITIAL_INDEX,n.scriptToAddressCache={},X(e.type,exports.IdentityType.MasterPublicKey),!H(e.opts.masterPublicKey))throw new Error("Master public key is not valid");if(!D(e.opts.masterBlindingKey))throw new Error("Master blinding key is not valid");return n.masterPublicKeyNode=o(e.ecclib).fromBase58(e.opts.masterPublicKey),n.masterBlindingKeyNode=a.SLIP77Factory(e.ecclib).fromMasterBlindingKey(e.opts.masterBlindingKey),n.baseDerivationPath=e.opts.baseDerivationPath||r.INITIAL_BASE_PATH,n}b(r,t);var n=r.prototype;return n.blindPset=function(){var e=x(O.mark((function e(r,n,i,o){var a=this;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.prototype.blindPsetWithBlindKeysGetter.call(this,(function(t){return a.getBlindingKeyPair(t.toString("hex"),!0)}),r,n,i,o));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),n.isAbleToSign=function(){return!1},n.derivePublicKeyWithIndex=function(t,e){return this.masterPublicKeyNode.derive(t?1:0).derive(e).publicKey},n.getBlindingKeyPair=function(t,e){if(void 0===e&&(e=!1),e&&!this.scriptToAddressCache[t])throw new Error("unknow blinding key for script "+t);var r=this.masterBlindingKeyNode.derive(t);return{publicKey:r.publicKey,privateKey:r.privateKey}},n.scriptFromPublicKey=function(t){return e.payments.p2wpkh({pubkey:t,network:this.network}).output.toString("hex")},n.createConfidentialAddress=function(t,r){return e.payments.p2wpkh({pubkey:t,blindkey:r,network:this.network}).confidentialAddress},n.persistAddressToCache=function(t){var e=Buffer.from(t.publicKey,"hex"),r=this.scriptFromPublicKey(e);this.scriptToAddressCache[r]=t},n.getAddress=function(t,e){var r=this.derivePublicKeyWithIndex(t,e),n=this.scriptFromPublicKey(r),i=this.getBlindingKeyPair(n),o=this.createConfidentialAddress(r,i.publicKey),a=this.baseDerivationPath+"/"+(t?1:0)+"/"+e;return{address:{confidentialAddress:o,blindingPrivateKey:i.privateKey.toString("hex"),derivationPath:a,publicKey:r.toString("hex")},publicKey:r.toString("hex")}},n.getNextAddress=function(){var t=x(O.mark((function t(){var e;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getAddress(!1,this.index),this.persistAddressToCache(e),this.index=this.index+1,t.abrupt("return",e.address);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getNextChangeAddress=function(){var t=x(O.mark((function t(){var e;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.getAddress(!0,this.changeIndex),this.persistAddressToCache(e),this.changeIndex=this.changeIndex+1,t.abrupt("return",e.address);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getBlindingPrivateKey=function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getBlindingKeyPair(e).privateKey.toString("hex"));case 1:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n.signPset=function(t){throw new Error("MasterPublicKey is a watch only identity. Use Mnemonic to sign transactions")},n.getAddresses=function(){var t=x(O.mark((function t(){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Object.values(this.scriptToAddressCache).map((function(t){return t.address})));case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getXPub=function(){return this.masterPublicKeyNode.toBase58()},r}(J);tt.INITIAL_BASE_PATH="m/84'/0'/0'",tt.INITIAL_INDEX=0;var et=function(t){function r(r){var i;X(r.type,exports.IdentityType.Mnemonic),n.setDefaultWordlist(r.opts.language||"english"),q(r.opts.mnemonic);var s=n.mnemonicToSeedSync(r.opts.mnemonic,r.opts.passphrase),u=e.networks[r.chain],c=o(r.ecclib).fromSeed(s,u),p=R(c.derivePath(r.opts.baseDerivationPath||tt.INITIAL_BASE_PATH).neutered().toBase58()),f=a.SLIP77Factory(r.ecclib).fromSeed(s),l=f.masterKey.toString("hex");return(i=t.call(this,y({},r,{type:exports.IdentityType.MasterPublicKey,opts:{masterPublicKey:p,masterBlindingKey:l,baseDerivationPath:r.opts.baseDerivationPath}}))||this).masterBlindingKey=l,i.masterBlindingKeyNode=f,i.masterPublicKey=p,i.masterPrivateKeyNode=c,i.mnemonic=r.opts.mnemonic,i}b(r,t);var i=r.prototype;return i.blindPset=function(){var e=x(O.mark((function e(r,n,i,o){var a=this;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.prototype.blindPsetWithBlindKeysGetter.call(this,(function(e){return t.prototype.getBlindingKeyPair.call(a,e.toString("hex"),!0)}),r,n,i,o));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),i.isAbleToSign=function(){return!0},i.derivePath=function(t){if(!this.ecclib)throw new Error("ecclib is missing, cannot derive public key");var e=this.masterPrivateKeyNode.derivePath(t).toWIF(),r=s(this.ecclib).fromWIF(e,this.network);return{publicKey:r.publicKey,privateKey:r.privateKey}},i.signPset=function(){var t=x(O.mark((function t(r){var n,i,o,a,u,c,p;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.ecclib){t.next=2;break}throw new Error("ecclib is missing, cannot sign pset");case 2:for(n=e.Psbt.fromBase64(r),i=[],o=0;o<n.data.inputs.length;o++)(a=n.data.inputs[o]).witnessUtxo&&(u=this.scriptToAddressCache[a.witnessUtxo.script.toString("hex")])&&(c=this.derivePath(u.address.derivationPath).privateKey,p=s(this.ecclib).fromPrivateKey(c),i.push(n.signInputAsync(o,p)));return t.next=7,Promise.all(i);case 7:return t.abrupt("return",n.toBase64());case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.Random=function(t,e,i){var o=n.generateMnemonic();return new r({chain:t,ecclib:e,type:exports.IdentityType.Mnemonic,opts:{mnemonic:o,baseDerivationPath:i}})},r}(tt),rt=function(t){function r(r){var n;n=t.call(this,r)||this,X(r.type,exports.IdentityType.PrivateKey),n.signingKeyPair=n.decodeFromWif(r.opts.signingKeyWIF),n.blindingKeyPair=n.decodeFromWif(r.opts.blindingKeyWIF);var i=e.payments.p2wpkh({pubkey:n.signingKeyPair.publicKey,blindkey:n.blindingKeyPair.publicKey,network:n.network});return n.confidentialAddress=i.confidentialAddress,n.blindingPrivateKey=n.blindingKeyPair.privateKey.toString("hex"),n.scriptPubKey=i.output,n}b(r,t);var n=r.prototype;return n.blindPset=function(){var e=x(O.mark((function e(r,n,i,o){var a=this;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.prototype.blindPsetWithBlindKeysGetter.call(this,(function(t){return a.getBlindingKeyPair(t)}),r,n,i,o));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),n.getBlindingKeyPair=function(t){if(!t.equals(this.scriptPubKey))throw new Error(t+" is unknown by the PrivateKey Identity");return{publicKey:this.blindingKeyPair.publicKey,privateKey:this.blindingKeyPair.privateKey}},n.isAbleToSign=function(){return!0},n.decodeFromWif=function(t){return s(this.ecclib).fromWIF(t,this.network)},n.getAddress=function(){return{confidentialAddress:this.confidentialAddress,blindingPrivateKey:this.blindingPrivateKey,derivationPath:void 0,publicKey:this.signingKeyPair.publicKey.toString("hex")}},n.getNextAddress=function(){var t=x(O.mark((function t(){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getAddress());case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getNextChangeAddress=function(){var t=x(O.mark((function t(){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.getAddress());case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getBlindingPrivateKey=function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Buffer.from(e,"hex").equals(this.scriptPubKey)){t.next=3;break}throw new Error("The script is not PrivateKey.scriptPubKey.");case 3:return t.abrupt("return",this.blindingPrivateKey);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n.signPset=function(){var t=x(O.mark((function t(r){var n,i,o,a,s=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=e.Psbt.fromBase64(r),i=[],o=0;o<n.data.inputs.length;o++)(a=n.data.inputs[o]).witnessUtxo?a.witnessUtxo.script.equals(this.scriptPubKey)&&i.push(o):i.push(o);return t.next=5,Promise.all(i.map((function(t){return n.signInputAsync(t,s.signingKeyPair)})));case 5:return t.abrupt("return",n.toBase64());case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),n.getAddresses=function(){var t=x(O.mark((function t(){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",[{confidentialAddress:this.confidentialAddress,blindingPrivateKey:this.blindingPrivateKey,derivationPath:void 0,publicKey:this.signingKeyPair.publicKey.toString("hex")}]);case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r}(J),nt=function(t){function e(e){var r;if(r=t.call(this,e)||this,X(e.type,exports.IdentityType.Inject),void 0===window||void 0===window[e.opts.windowProvider])throw new Error("The value.windowProvider of IdentityOpts is not valid or the script is to injected in the window");return r.provider=window[e.opts.windowProvider],r}b(e,t);var r=e.prototype;return r.getNextAddress=function(){return this.provider.getNextAddress()},r.getNextChangeAddress=function(){return this.provider.getNextChangeAddress()},r.signPset=function(t){return this.provider.signTransaction(t)},r.getAddresses=function(){return this.provider.getAddresses()},r.getBlindingPrivateKey=function(t){throw new Error("Method not implemented.")},r.isAbleToSign=function(){return!0},r.blindPset=function(t,e,r,n){throw new Error("Method not implemented.")},e}(J);function it(t,e){if(t.length!==e.length)throw new Error("a.length !== b.length (xor)");for(var r=Buffer.alloc(t.length),n=0;n<t.length;n++)r[n]=t[n]^e[n];return r}function ot(t){return t.sort(at)}function at(t,e){return t.toString("hex")<e.toString("hex")?-1:1}var st=function(t){function r(r){var i;(i=t.call(this,r)||this).nextIndex=0,i.nextChangeIndex=0,X(r.type,exports.IdentityType.MultisigWatchOnly),function(t,e){if(t<=0||t>e)throw new Error("number of required signatures must be > 0 and <= "+e)}(r.opts.requiredSignatures,r.opts.cosigners.length);var s,u,c=r.opts.cosigners.map((function(t){return function(t,e,r){if("string"==typeof t)return t;var i=n.mnemonicToSeedSync(t.mnemonic,t.passphrase),a=o(r),s=a.fromSeed(i,e).derivePath(t.baseDerivationPath||"m/48'/0'/0'/2'");return R(a.fromPublicKey(s.publicKey,s.chainCode,e).toBase58())}(t,i.network,i.ecclib)}));return c.forEach(H),i.cosigners=c.sort().map((function(t){return o(i.ecclib).fromBase58(t)})),i.blindingKeyMasterNode=(s=i.ecclib,u=function(t){for(var r,n=Buffer.from("blinding_key"),i=Buffer.alloc(32),o=T(t);!(r=o()).done;)i=it(i,r.value);return e.crypto.sha256(Buffer.concat([n,i]))}(i.cosigners.map((function(t){return t.chainCode}))),a.SLIP77Factory(s).fromSeed(u)),i.requiredSignatures=r.opts.requiredSignatures,i}b(r,t);var i=r.prototype;return i.getNextAddress=function(){var t=this.getMultisigAddress(r.EXTERNAL_INDEX,this.nextIndex);return this.nextIndex++,Promise.resolve(t)},i.getNextChangeAddress=function(){var t=this.getMultisigAddress(r.INTERNAL_INDEX,this.nextChangeIndex);return this.nextChangeIndex++,Promise.resolve(t)},i.getAddresses=function(){var t=this,e=Array.from(Array(this.nextIndex).keys()).map((function(e){return t.getMultisigAddress(r.EXTERNAL_INDEX,e)})),n=Array.from(Array(this.nextChangeIndex).keys()).map((function(e){return t.getMultisigAddress(r.INTERNAL_INDEX,e)}));return Promise.resolve(e.concat(n))},i.getBlindingPrivateKey=function(t){var e=this.getBlindingKeyPair(t).privateKey;return Promise.resolve(e.toString("hex"))},i.getBlindingKeyPair=function(t){var e=this.blindingKeyMasterNode.derive(t);if(!e.publicKey||!e.privateKey)throw new Error("unable to generate blinding key pair");return{publicKey:e.publicKey,privateKey:e.privateKey}},i.isAbleToSign=function(){return!1},i.signPset=function(t){throw new Error("WatchOnly Multisig Identity is not able to sign pset")},i.blindPset=function(e,r,n,i){var o=this;return t.prototype.blindPsetWithBlindKeysGetter.call(this,(function(t){return o.getBlindingKeyPair(t.toString("hex"))}),e,r,n,i)},i.getMultisigAddress=function(t,r){return y({},function(t,r,n,i){var o=e.payments.p2wsh({redeem:e.payments.p2ms({m:parseInt(n.toString()),pubkeys:ot(t.map((function(t){return t.publicKey}))),network:i}),network:i});if(!o.address)throw new Error("Invalid payment");var a=r.derive(e.address.toOutputScript(o.address,i)),s=a.publicKey,u=a.privateKey;if(!s||!u)throw new Error("something went wrong while generating blinding key pair");if(!(o=e.payments.p2wsh({redeem:e.payments.p2ms({m:parseInt(n.toString()),pubkeys:ot(t.map((function(t){return t.publicKey}))),network:i}),blindkey:s,network:i})).confidentialAddress||!o.redeem||!o.redeem.output)throw new Error("invalid payment");return{blindingPrivateKey:u.toString("hex"),confidentialAddress:o.confidentialAddress,witnessScript:o.redeem.output.toString("hex")}}(this.cosigners.map((function(e){return e.derive(t).derive(r)})),this.blindingKeyMasterNode,this.requiredSignatures,this.network),{derivationPath:t+"/"+r})},r}(J);st.EXTERNAL_INDEX=0,st.INTERNAL_INDEX=1;var ut=function(t){function r(r){var i;X(r.type,exports.IdentityType.Multisig),q(r.opts.signer.mnemonic);var a=n.mnemonicToSeedSync(r.opts.signer.mnemonic,r.opts.signer.passphrase),s=e.networks[r.chain],u=o(r.ecclib).fromSeed(a,s).derivePath(r.opts.signer.baseDerivationPath||"m/48'/0'/0'/2'");return(i=t.call(this,y({},r,{opts:y({},r.opts,{cosigners:r.opts.cosigners.concat([r.opts.signer])}),type:exports.IdentityType.MultisigWatchOnly}))||this).baseDerivationPath=r.opts.signer.baseDerivationPath||"m/48'/0'/0'/2'",i.baseNode=u,i.scriptToPath={},i}b(r,t);var i=r.prototype;return i.getNextAddress=function(){var e=x(O.mark((function e(){var r;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prototype.getNextAddress.call(this);case 2:if((r=e.sent).derivationPath){e.next=5;break}throw new Error("need derivation path to cache addresses");case 5:return this.scriptToPath[this.toScript(r.confidentialAddress)]=r.derivationPath,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.getNextChangeAddress=function(){var e=x(O.mark((function e(){var r;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prototype.getNextChangeAddress.call(this);case 2:if((r=e.sent).derivationPath){e.next=5;break}throw new Error("need derivation path to cache addresses");case 5:return this.scriptToPath[this.toScript(r.confidentialAddress)]=r.derivationPath,e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),i.isAbleToSign=function(){return!0},i.signPset=function(){var t=x(O.mark((function t(r){var n,i,o,a,u,c,p;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.Psbt.fromBase64(r),i=[],o=0;case 3:if(!(o<n.data.inputs.length)){t.next=16;break}if(!(a=n.data.inputs[o]).witnessUtxo){t.next=13;break}if(!(u=this.scriptToPath[a.witnessUtxo.script.toString("hex")])){t.next=13;break}if(c=this.baseNode.derivePath(u).privateKey){t.next=11;break}throw new Error("signing private key is undefined");case 11:p=s(this.ecclib).fromPrivateKey(c),i.push(n.signInputAsync(o,p));case 13:o++,t.next=3;break;case 16:return t.next=18,Promise.all(i);case 18:return t.abrupt("return",n.toBase64());case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.getXPub=function(){return R(o(this.ecclib).fromPublicKey(this.baseNode.publicKey,this.baseNode.chainCode,this.network).toBase58())},i.toScript=function(t){return e.address.toOutputScript(t,this.network).toString("hex")},r}(st),ct=function(t,e,r){throw new Error("not enought funds to fill "+e+"sats of "+t+" (amount selected: "+r+")")};function pt(t,e){return t.set(e.asset,(t.get(e.asset)||0)+e.value),t}function ft(t){return function(e){return $(e)===t}}var lt=function(t){return function(e){var r=e.map((function(t){return{value:Z(t)||0,asset:$(t)||""}}));return dt(r)(t)}},dt=function(t){return function(e){var r=function(t){return t.reduce((function(t,e){return(t[e.asset]=t[e.asset]||[]).push(e),t}),{})},n=r(t),i=r(e),o=Object.keys(n).sort(),a=Object.keys(i).sort();if(!o.every((function(t){return a.includes(t)})))throw new Error("inputs and outputs don't have the same assets. Inputs assets = "+o+", Outputs assets = "+a);for(var s in n){var u=ht(n[s].map((function(t){return t.value}))),c=ht(i[s].map((function(t){return t.value})));if(u!==c)throw new Error("missing funds for asset "+s+" (inputs: "+u+", outputs: "+c+")")}}},ht=function(t){return t.reduce((function(t,e){return t+e}),0)},vt=function(t,e){return Z(t)-Z(e)};function xt(t,e){return yt.apply(this,arguments)}function yt(){return(yt=x(O.mark((function t(e,r){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.get(r+"/tx/"+e+"/hex");case 2:return t.abrupt("return",t.sent.data);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function bt(){return(bt=x(O.mark((function t(e,r){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Pt,t.next=3,u.get(r+"/tx/"+e);case 3:return t.t1=t.sent.data,t.t2=r,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function gt(t,e){return wt.apply(this,arguments)}function wt(){return(wt=x(O.mark((function t(e,r){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.get(r+"/address/"+e+"/utxo");case 2:return t.abrupt("return",Promise.all(t.sent.data.map(mt(r))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var mt=function(t){return function(){var r=x(O.mark((function r(n){var i;return O.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,xt(n.txid,t);case 2:return i=e.Transaction.fromHex(r.sent).outs[n.vout],r.abrupt("return",y({},n,{prevout:i}));case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()};function Pt(t,e){return Et.apply(this,arguments)}function Et(){return(Et=x(O.mark((function t(r,n){var i,o,a,s,u,c,p,f,l,d;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=[],o=[],a=T(r.vin);!(s=a()).done;)i.push((u=s.value).txid),o.push(u.vout);return t.next=5,Promise.all(i.map((function(t,e){return r.vin[e].is_pegin?Promise.resolve(void 0):xt(t,n)})));case 5:return c=t.sent.map((function(t,r){if(t)return kt({txid:i[r],vout:o[r]},e.Transaction.fromHex(t).outs[o[r]])})),p=i.map((function(t,e){return{prevout:c[e],txid:t,vout:o[e],isPegin:r.vin[e].is_pegin}})),t.next=10,xt(r.txid,n);case 10:return f=e.Transaction.fromHex(t.sent),l=function(t){return{txid:r.txid,vout:t}},d=f.outs.map((function(t,e){return kt(l(e),t)})),t.abrupt("return",{txid:r.txid,vin:p,vout:d,fee:r.fee,status:{confirmed:r.status.confirmed,blockHash:r.status.block_hash,blockHeight:r.status.block_height,blockTime:r.status.block_time}});case 17:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function kt(t,e){return y({},t,{prevout:e})}function Tt(t,e,r){return t+"/tx/"+e+"#blinded="+r.map((function(t){return t.value+","+t.asset+","+t.valueBlinder+","+t.assetBlinder})).join(",")}var At=function(t){function e(e,r,n){return t.call(this,"UnblindError output ("+e+":"+r+") with blind key "+n)||this}return b(e,t),e}(E(Error));function Ot(t,e,r,n){return St.apply(this,arguments)}function St(){return(St=d(O.mark((function t(e,r,n,i){var o,a,s,u,c,p,f,l,d,v;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=[],a=[],s=T(e);case 3:if((u=s()).done){t.next=40;break}return c=u.value,t.prev=5,p=_t(c,n,i),t.next=9,h(p.next());case 9:f=t.sent;case 10:if(f.done){t.next=31;break}if(!o.includes((l=f.value).txid)){t.next=17;break}return t.next=15,h(p.next());case 15:return f=t.sent,t.abrupt("continue",10);case 17:return t.next=19,h(Nt(l,function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r(e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 19:return v=(d=t.sent).unblindedTx,a.push.apply(a,d.errors),t.next=25,v;case 25:return o.push(l.txid),t.next=28,h(p.next());case 28:f=t.sent,t.next=10;break;case 31:t.next=38;break;case 33:t.prev=33,t.t0=t.catch(5),t.t0 instanceof Error&&a.push(t.t0),"string"==typeof t.t0&&a.push(new Error(t.t0)),a.push(new Error("unknown error"));case 38:t.next=3;break;case 40:return t.abrupt("return",{txIDs:o,errors:a});case 41:case"end":return t.stop()}}),t,null,[[5,33]])})))).apply(this,arguments)}function It(){return(It=x(O.mark((function t(e,r,n,i){var o,a,s;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Ot(e,r,n,i),a=[],t.next=4,o.next();case 4:s=t.sent;case 5:if(s.done){t.next=12;break}return a.push(s.value),t.next=9,o.next();case 9:s=t.sent,t.next=5;break;case 12:return t.abrupt("return",a);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _t(t,e,r){return Kt.apply(this,arguments)}function Kt(){return(Kt=d(O.mark((function t(e,r,n){var i,o,a,s,u,c,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=void 0,o=[],a=0;case 3:return t.next=5,h(Bt(e,r,i));case 5:if(0!==(o=t.sent).length){t.next=8;break}return t.abrupt("break",24);case 8:i=o[o.length-1].txid,a+=o.length,s=o.map((function(t){return Pt(t,r)})),u=T(s);case 12:if((c=u()).done){t.next=23;break}return p=c.value,t.next=16,h(p);case 16:if(f=t.sent,null==n||!n(f)){t.next=19;break}return t.abrupt("continue",21);case 19:return t.next=21,f;case 21:t.next=12;break;case 23:if(i){t.next=3;break}case 24:return t.abrupt("return",a);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Nt(t,e){return Ut.apply(this,arguments)}function Ut(){return(Ut=x(O.mark((function t(e,r){var n,i,o,a,s,u;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=[],i=[],o=function(t){var o=e.vin[t].prevout;o&&K(o.prevout)&&n.push(function(){var n=x(O.mark((function n(){var a;return O.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r(o.prevout.script.toString("hex"));case 2:if(!(a=n.sent)){n.next=14;break}return n.prev=4,n.next=7,G(o,a);case 7:e.vin[t].prevout=n.sent,n.next=14;break;case 11:n.prev=11,n.t0=n.catch(4),i.push(new At(e.vin[t].txid,e.vin[t].vout,a));case 14:case"end":return n.stop()}}),n,null,[[4,11]])})));return function(){return n.apply(this,arguments)}}()())},a=0;a<e.vin.length;a++)o(a);for(s=function(t){var o=e.vout[t];z(o)||n.push(function(){var n=x(O.mark((function n(){var a;return O.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r(o.prevout.script.toString("hex"));case 2:if(!(a=n.sent)){n.next=14;break}return n.prev=4,n.next=7,G(o,a);case 7:e.vout[t]=n.sent,n.next=14;break;case 11:n.prev=11,n.t0=n.catch(4),i.push(new At(e.txid,t,a));case 14:case"end":return n.stop()}}),n,null,[[4,11]])})));return function(){return n.apply(this,arguments)}}()())},u=0;u<e.vout.length;u++)s(u);return t.next=8,Promise.all(n);case 8:return t.abrupt("return",{unblindedTx:e,errors:i});case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Bt(t,e,r){return Rt.apply(this,arguments)}function Rt(){return(Rt=x(O.mark((function t(e,r,n){var i;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=r+"/address/"+e+"/txs/chain",n&&(i+="/"+n),t.next=4,u.get(i);case 4:return t.abrupt("return",t.sent.data);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lt(t,e,r,n){return Mt.apply(this,arguments)}function Mt(){return(Mt=d(O.mark((function t(r,n,i,o){var a,u,c,p,f,l,d,v,x,y,b,g;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=0,u=[],c=T(n);case 3:if((p=c()).done){t.next=35;break}if(l=(f=p.value).confidentialAddress,d=f.blindingPrivateKey,t.prev=5,!(d.length>0)){t.next=11;break}if(v=s(r).fromPrivateKey(Buffer.from(d,"hex")),x=e.address.fromConfidential(l).blindingKey,v.publicKey.equals(x)){t.next=11;break}throw new Error("wrong blinding private key");case 11:return t.next=13,h(gt(l,i));case 13:y=T(t.sent);case 15:if((b=y()).done){t.next=26;break}if(g=b.value,null==o||!o(g)){t.next=19;break}return t.abrupt("continue",24);case 19:return t.next=21,h(Dt(g,d));case 21:return t.next=23,t.sent;case 23:a++;case 24:t.next=15;break;case 26:t.next=33;break;case 28:t.prev=28,t.t0=t.catch(5),t.t0 instanceof Error&&u.push(t.t0),"string"==typeof t.t0&&u.push(new Error(t.t0)),u.push(new Error("unknow error"));case 33:t.next=3;break;case 35:return t.abrupt("return",{numberOfUtxos:a,errors:u});case 36:case"end":return t.stop()}}),t,null,[[5,28]])})))).apply(this,arguments)}function Ct(t,e,r,n){return Ht.apply(this,arguments)}function Ht(){return(Ht=x(O.mark((function t(e,r,n,i){var o,a,s;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Lt(e,r,n,i),a=[],t.next=4,o.next();case 4:s=t.sent;case 5:if(s.done){t.next=12;break}return a.push(s.value),t.next=9,o.next();case 9:s=t.sent,t.next=5;break;case 12:return t.abrupt("return",a);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Dt(t,e){return Ft.apply(this,arguments)}function Ft(){return(Ft=x(O.mark((function t(e,r){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.abrupt("return",G(e,r));case 4:throw t.prev=4,t.t0=t.catch(0),new At(e.txid,e.vout,r);case 7:case"end":return t.stop()}}),t,null,[[0,4]])})))).apply(this,arguments)}function jt(t,e,r,n){return Wt.apply(this,arguments)}function Wt(){return(Wt=d(O.mark((function t(r,n,i,o){var a,s,u,c,p,f,l;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=0,s=[],t.next=4,h(i.fetchUtxos(r,o));case 4:u=T(t.sent);case 6:if((c=u()).done){t.next=33;break}if(p=c.value,t.prev=8,K(p.prevout)){t.next=12;break}return t.next=12,y({},p,{unblindData:{asset:p.prevout.asset.slice(1),value:e.confidential.confidentialValueToSatoshi(p.prevout.value).toString(10),assetBlindingFactor:Buffer.alloc(32),valueBlindingFactor:Buffer.alloc(32)}});case 12:return t.next=14,h(n(p.prevout.script.toString("hex")));case 14:if(f=t.sent){t.next=17;break}return t.abrupt("continue",31);case 17:return t.next=19,h(Dt(p,f));case 19:return l=t.sent,t.next=22,l;case 22:a++,t.next=31;break;case 25:t.prev=25,t.t0=t.catch(8),console.log(t.t0),t.t0 instanceof Error&&s.push(t.t0),"string"==typeof t.t0&&s.push(new Error(t.t0)),s.push(new Error("unknown error"));case 31:t.next=6;break;case 33:return t.abrupt("return",{numberOfUtxos:a,errors:s});case 34:case"end":return t.stop()}}),t,null,[[8,25]])})))).apply(this,arguments)}function Gt(t,e,r,n){return Vt.apply(this,arguments)}function Vt(){return(Vt=d(O.mark((function t(e,r,n,i){var o,a,s,u,c,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=[],a=[],t.next=4,h(n.fetchTxs(e,i));case 4:s=T(t.sent);case 6:if((u=s()).done){t.next=27;break}return c=u.value,t.prev=8,t.next=11,h(Nt(c,r));case 11:return f=(p=t.sent).unblindedTx,a.push.apply(a,p.errors),t.next=17,f;case 17:o.push(c.txid),t.next=25;break;case 20:t.prev=20,t.t0=t.catch(8),t.t0 instanceof Error&&a.push(t.t0),"string"==typeof t.t0&&a.push(new Error(t.t0)),a.push(new Error("unknown error"));case 25:t.next=6;break;case 27:return t.abrupt("return",{txIDs:o,errors:a});case 28:case"end":return t.stop()}}),t,null,[[8,20]])})))).apply(this,arguments)}function Xt(){return(Xt=x(O.mark((function t(e,r,n,i){var o,a,s,u,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=[],a=!1,s=!1,t.prev=3,p=c(Gt(e,r,n,i));case 5:return t.next=7,p.next();case 7:if(!(a=!(f=t.sent).done)){t.next=13;break}o.push(f.value);case 10:a=!1,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),s=!0,u=t.t0;case 19:if(t.prev=19,t.prev=20,!a||null==p.return){t.next=24;break}return t.next=24,p.return();case 24:if(t.prev=24,!s){t.next=27;break}throw u;case 27:return t.finish(24);case 28:return t.finish(19);case 29:return t.abrupt("return",o);case 30:case"end":return t.stop()}}),t,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}function qt(){return(qt=x(O.mark((function t(e,r,n,i){var o,a,s,u,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=[],a=!1,s=!1,t.prev=3,p=c(jt(e,r,n,i));case 5:return t.next=7,p.next();case 7:if(!(a=!(f=t.sent).done)){t.next=13;break}o.push(f.value);case 10:a=!1,t.next=5;break;case 13:t.next=19;break;case 15:t.prev=15,t.t0=t.catch(3),s=!0,u=t.t0;case 19:if(t.prev=19,t.prev=20,!a||null==p.return){t.next=24;break}return t.next=24,p.return();case 24:if(t.prev=24,!s){t.next=27;break}throw u;case 27:return t.finish(24);case 28:return t.finish(19);case 29:return t.abrupt("return",o);case 30:case"end":return t.stop()}}),t,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var Yt=function(){function t(t,e){this.electrsURL=t,this.axios=null!=e?e:u.create()}t.fromURL=function(e){return new t(e)};var r=t.prototype;return r.addressesHasBeenUsed=function(){var t=x(O.mark((function t(e){var r=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(e.map(function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.get(r.electrsURL+"/address/"+e+"/txs");case 3:return t.abrupt("return",t.sent.data.length>0);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}())));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r.fetchUtxos=function(){var t=x(O.mark((function t(e,r){var n,i,o,a=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.map((function(t){return a.axios.get(a.electrsURL+"/address/"+t+"/utxo")})),t.next=3,Promise.allSettled(n);case 3:return i=t.sent.map((function(t){return"fulfilled"===t.status?t.value.data:[]})),o=i.map((function(t){return t||[]})),t.abrupt("return",Promise.all(o.flat().filter((function(t){return!r||!r(t)})).map(this.outpointToUtxo())));case 7:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),r.fetchTxs=function(){var t=x(O.mark((function t(e,r){var n,i=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.map(this.fetchAllTxsForAddress()));case 2:return n=t.sent.flat().filter((function(t){return!r||!r(t)})).map(Zt((function(t){return i.fetchTxsHex(t)}))),t.abrupt("return",Promise.all(n));case 5:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),r.fetchTxHex=function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.axios.get(this.electrsURL+"/tx/"+e+"/hex");case 2:return t.abrupt("return",t.sent.data);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.fetchTxsHex=function(){var t=x(O.mark((function t(e){var r=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(e.map(function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,r.fetchTxHex(e);case 3:return t.t1=t.sent,t.abrupt("return",{txid:t.t0,hex:t.t1});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r.fetchTx=function(){var t=x(O.mark((function t(e){var r=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Zt((function(t){return r.fetchTxsHex(t)})),t.next=3,this.axios.get(this.electrsURL+"/tx/"+e);case 3:return t.t1=t.sent.data,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.fetchAllTxsForAddress=function(){var t=this;return function(){var e=x(O.mark((function e(r){var n,i,o;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0,i=[];case 2:return e.next=4,t.fetch25newestTxsForAddress(r,n);case 4:if(0!==(o=e.sent).length){e.next=7;break}return e.abrupt("break",12);case 7:if(i.push.apply(i,o),!(o.length<25)){e.next=10;break}return e.abrupt("break",12);case 10:n=o[o.length-1].txid;case 11:if(n){e.next=2;break}case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},r.fetch25newestTxsForAddress=function(){var t=x(O.mark((function t(e,r){var n;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.electrsURL+"/address/"+e+"/txs/chain",r&&(n+="/"+r),t.next=4,this.axios.get(n);case 4:return t.abrupt("return",t.sent.data);case 6:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),r.outpointToUtxo=function(){var t=this;return function(){var r=x(O.mark((function r(n){var i;return O.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.fetchTxHex(n.txid);case 2:return i=e.Transaction.fromHex(r.sent).outs[n.vout],r.abrupt("return",y({},n,{prevout:i}));case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()},t}(),Qt=function(t){function e(e,r,n){var i;return(i=t.call(this,r,n)||this).batchServerURL=e,i.electrsURL=r,i}b(e,t),e.fromURL=function(t){throw new Error("Not implemented: use Electrs.fromURL or ElectrsBatchServer.fromURLs instead")},e.fromURLs=function(t,r){return new e(t,r)};var r=e.prototype;return r.addressesHasBeenUsed=function(){var t=x(O.mark((function t(e){var r,n,i;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post(this.batchServerURL+"/addresses/transactions",{addresses:e});case 2:for(r=[],n=T(t.sent.data);!(i=n()).done;)r.push(i.value.transaction.length>0);return t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.fetchUtxos=function(){var e=x(O.mark((function e(r,n){var i,o,a,s,u;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.axios.post(this.batchServerURL+"/addresses/utxo",{addresses:r});case 2:if(200===(i=e.sent).status){e.next=5;break}throw new Error("Error fetching utxos: "+i.status);case 5:if(i.data&&Array.isArray(i.data)){e.next=7;break}throw new Error("Invalid response from batch server");case 7:o=[],a=T(i.data);case 9:if((s=a()).done){e.next=18;break}if(u=s.value.utxo,Array.isArray(u)){e.next=13;break}return e.abrupt("continue",16);case 13:if(0!==u.length){e.next=15;break}return e.abrupt("continue",16);case 15:o.push.apply(o,u);case 16:e.next=9;break;case 18:return e.next=20,Promise.all(o.filter((function(t){return!n||!n(t)})).map(t.prototype.outpointToUtxo.call(this)));case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}(),r.fetchTxsHex=function(){var t=x(O.mark((function t(e){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post(this.batchServerURL+"/transactions/hex",{txids:e});case 2:return t.abrupt("return",t.sent.data||[]);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),r.fetchTxs=function(){var t=x(O.mark((function t(e,r){var n,i,o,a,s=this;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.axios.post(this.batchServerURL+"/addresses/transactions",{addresses:e});case 2:n=[],i=T(t.sent.data);case 5:if((o=i()).done){t.next=12;break}if(0!==(a=o.value.transaction).length){t.next=9;break}return t.abrupt("continue",10);case 9:n.push.apply(n,a.filter((function(t){return!r||!r(t)})).map(Zt((function(t){return s.fetchTxsHex(t)}))));case 10:t.next=5;break;case 12:return t.abrupt("return",Promise.all(n));case 13:case"end":return t.stop()}}),t,this)})));return function(e,r){return t.apply(this,arguments)}}(),e}(Yt);function zt(t,e){return y({},t,{prevout:e})}function Zt(t){return function(){var r=x(O.mark((function r(n){var i,o,a,s,u,c,p,f;return O.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t([].concat(n.vin.filter((function(t){return!t.is_pegin})).map((function(t){return t.txid})),[n.txid]));case 2:if(o=r.sent,a=function(t){var r=t.txid,n=t.vout,i=null==o?void 0:o.find((function(t){return t.txid===r}));if(!i)throw new Error("Could not find tx "+r);var a=e.Transaction.fromHex(i.hex).outs[n];return zt({txid:r,vout:n},a)},s=n.vin.map((function(t){return{prevout:t.is_pegin?void 0:a(t),txid:t.txid,vout:t.vout,isPegin:t.is_pegin}})),u=null==o||null==(i=o.find((function(t){return t.txid===n.txid})))?void 0:i.hex){r.next=8;break}throw new Error("Could not find tx "+n.txid);case 8:return c=e.Transaction.fromHex(u),p=function(t){return{txid:n.txid,vout:t}},f=c.outs.map((function(t,e){return zt(p(e),t)})),r.abrupt("return",{txid:n.txid,vin:s,vout:f,fee:n.fee,status:{confirmed:n.status.confirmed,blockHash:n.status.block_hash,blockHeight:n.status.block_height,blockTime:n.status.block_time}});case 14:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()}function $t(t,r,n,i,o,a){void 0===o&&(o=!1),void 0===a&&(a=Jt);var s=e.address.getNetwork(r.address),u=o&&r.asset===s.assetHash,c=n(ct)(t,[r],i),p=ee(c.selectedUtxos.length,c.changeOutputs.length+2,a,s.assetHash),f=ct;u&&(f=function(t,e,n){t!==r.asset?ct(t,e,n):r.value=n-p.value});var l=n(f)(t,[r,p],i),d=l.selectedUtxos,h=[r].concat(l.changeOutputs,[p]);return lt(h)(d),re(new e.Psbt({network:s}).toBase64(),d,h)}var Jt=.1;function te(t){var r=function(t){if(t.satsPerByte||(t.satsPerByte=Jt),t.errorHandler||(t.errorHandler=ct),t.addFee||(t.addFee=!1),t.addFee&&t.satsPerByte<.1)throw new Error("satsPerByte minimum value is 0.1");if(0===t.recipients.length)throw new Error("need a least one recipient output to build the transaction");if(0===t.unspents.length)throw new Error("need at least one unspent to fund the transaction");return t}(t),n=r.changeAddressByAsset,i=r.coinSelector,o=r.psetBase64,a=r.recipients,s=r.unspents,u=r.addFee,c=r.satsPerByte,p=r.errorHandler,f=i(p)(s,a,n);if(!u){var l=a.concat(f.changeOutputs);return lt(l)(f.selectedUtxos),re(o,f.selectedUtxos,l)}var d=function(t,r,n,i){var o=Y(t);return ee(o.data.inputs.length+r.selectedUtxos.length+1,o.data.outputs.length+n.length+r.changeOutputs.length+1,i,e.address.getNetwork(n[0].address).assetHash)}(o,f,a,c),h=i(p)(s,[].concat(a,[d]),n),v=h.selectedUtxos,x=[].concat(a,h.changeOutputs,[d]);return lt(x)(v),re(o,v,x)}function ee(t,e,r,n){var i=ne(t,e);return{asset:n,value:Math.ceil(i*r),address:""}}function re(t,r,n){for(var i,o=Y(t),a=Buffer.alloc(1),s=T(n);!(i=s()).done;){var u=i.value,c=u.asset,p=u.value,f=u.address,l=""===f?Buffer.alloc(0):e.address.toOutputScript(f);o.addOutput({asset:e.AssetHash.fromHex(c,!1).bytes,value:e.confidential.satoshiToConfidentialValue(p),script:l,nonce:a})}for(var d,h=T(r);!(d=h()).done;){var v=d.value;o.addInput({hash:v.txid,index:v.vout,witnessUtxo:v.prevout})}return o.toBase64()}function ne(t,e){return(3*ie(!1,t,e,!1)+ie(!0,t,e,!0)+3)/4}function ie(t,e,r,n){var i=function(t,e){var r=40*e;return t&&(r+=105*e),r}(t,e),o=function(t,e){var r=67*e;return t&&(r+=4273*e),r+43}(n,r);return 9+oe(r)+oe(e)+i+o}function oe(t){return t<253?1:t<=65535?3:t<=4294967295?5:9}var ae=function(){function t(t,e){this.network=e,this.unspents=t}var r=t.prototype;return r.createTx=function(){return new e.Psbt({network:this.network}).toBase64()},r.buildTx=function(t,e,r,n,i,o){return te({psetBase64:t,recipients:e,coinSelector:r,changeAddressByAsset:n,addFee:i,satsPerByte:o,unspents:this.unspents})},r.sendTx=function(t,e,r,n,i){return void 0===n&&(n=!1),void 0===i&&(i=Jt),$t(this.unspents,t,e,r,n,i)},t}();function se(){return(se=x(O.mark((function t(e,r,n,i){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ct(e,r,n);case 2:return t.abrupt("return",ue(t.sent,i));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ue(t,e){return new ae(t,W(e))}function ce(t){return t.reduce((function(t,e){return t+Z(e)}),0)}function pe(t,r){var n=j(t),i=e.address.toOutputScript(r);return n.outs.findIndex((function(t){return t.script.equals(i)}))}function fe(t){try{return e.address.fromConfidential(t),!0}catch(t){return!1}}function le(t,e){return function(){var r=x(O.mark((function r(n){var i,o,a,s,u,c,p,f,l,d;return O.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=void 0===(i=n.esploraURL)?"https://blockstream.info/liquid/api":i,s=void 0===(a=n.gapLimit)?20:a,c=(u=function(){var t=x(O.mark((function t(e){var r,n,i,a,u;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0,n=0,i=void 0,a=O.mark((function t(){var a,u,c,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=n,t.next=3,Promise.all(Array.from(Array(s).keys()).map((function(t){return t+a})).map(e));case 3:return u=t.sent,t.next=6,Promise.all(u.map((function(t){return de(t,o)})));case 6:c=0,p=T(t.sent);case 9:if((f=p()).done){t.next=22;break}if(!f.value){t.next=16;break}i=c+n,r=0,t.next=19;break;case 16:if(++r!==s){t.next=19;break}return t.abrupt("return",{v:i});case 19:c++;case 20:t.next=9;break;case 22:n+=s;case 23:case"end":return t.stop()}}),t)}));case 4:if(!(r<s)){t.next=11;break}return t.delegateYield(a(),"t0",6);case 6:if("object"!=typeof(u=t.t0)){t.next=9;break}return t.abrupt("return",u.v);case 9:t.next=4;break;case 11:return t.abrupt("return",i);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())((function(t){return Promise.resolve(e(!1,t))})),p=u((function(t){return Promise.resolve(e(!0,t))})),r.next=6,Promise.all([c,p]);case 6:return l=(f=r.sent)[0],d=f[1],r.abrupt("return",ve(t)({lastUsedExternalIndex:l,lastUsedInternalIndex:d}));case 10:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}()}function de(t,e){return he.apply(this,arguments)}function he(){return(he=x(O.mark((function t(e,r){return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u.get(r+"/address/"+e+"/txs");case 3:return t.abrupt("return",t.sent.data.length>0);case 7:return t.prev=7,t.t0=t.catch(0),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function ve(t){return function(){var e=x(O.mark((function e(r){var n,i,o,a,s,u,c;return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.lastUsedInternalIndex,o=[],void 0!==(n=r.lastUsedExternalIndex))for(a=0;a<=n;a++)s=t.getNextAddress(),o.push(s);if(void 0!==i)for(u=0;u<=i;u++)c=t.getNextChangeAddress(),o.push(c);return e.next=6,Promise.all(o);case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var xe=e.script.OPS,ye=[xe.OP_PUSHDATA1,xe.OP_PUSHDATA2,xe.OP_PUSHDATA4,xe.OP_1NEGATE,xe.OP_RESERVED,xe.OP_IF,xe.OP_VERIF,xe.OP_VERNOTIF,xe.OP_ELSE,xe.OP_ENDIF,xe.OP_VERIFY,xe.OP_TOALTSTACK,xe.OP_FROMALTSTACK,xe.OP_2DROP,xe.OP_2DUP,xe.OP_3DUP,xe.OP_2OVER,xe.OP_2ROT,xe.OP_2SWAP,xe.OP_NIP,xe.OP_OVER,xe.OP_PICK,xe.OP_ROLL,xe.OP_ROT,xe.OP_SWAP,xe.OP_TUCK,xe.OP_CAT,xe.OP_SUBSTR,xe.OP_SUBSTR_LAZY,xe.OP_LEFT,xe.OP_RIGHT,xe.OP_SIZE,xe.OP_INVERT,xe.OP_AND,xe.OP_OR,xe.OP_XOR,xe.OP_EQUAL,xe.OP_EQUALVERIFY,xe.OP_RESERVED1,xe.OP_RESERVED2,xe.OP_1ADD,xe.OP_1SUB,xe.OP_2MUL,xe.OP_2DIV,xe.OP_NEGATE,xe.OP_ABS,xe.OP_NOT,xe.OP_0NOTEQUAL,xe.OP_ADD,xe.OP_SUB,xe.OP_MUL,xe.OP_DIV,xe.OP_MOD,xe.OP_LSHIFT,xe.OP_RSHIFT,xe.OP_BOOLAND,xe.OP_BOOLOR,xe.OP_NUMEQUAL,xe.OP_NUMEQUALVERIFY,xe.OP_NUMNOTEQUAL,xe.OP_LESSTHAN,xe.OP_GREATERTHAN,xe.OP_LESSTHANOREQUAL,xe.OP_GREATERTHANOREQUAL,xe.OP_MIN,xe.OP_MAX,xe.OP_WITHIN,xe.OP_RIPEMD160,xe.OP_SHA1,xe.OP_SHA256,xe.OP_HASH160,xe.OP_HASH256,xe.OP_CODESEPARATOR,xe.OP_CHECKMULTISIG,xe.OP_CHECKMULTISIGVERIFY,xe.OP_DETERMINISTICRANDOM,xe.OP_SHA256INITIALIZE,xe.OP_SHA256UPDATE,xe.OP_SHA256FINALIZE,xe.OP_ADD64,xe.OP_SUB64,xe.OP_MUL64,xe.OP_DIV64,xe.OP_NEG64,xe.OP_LESSTHAN64,xe.OP_LESSTHANOREQUAL64,xe.OP_GREATERTHAN64,xe.OP_GREATERTHANOREQUAL64,xe.OP_SCRIPTNUMTOLE64,xe.OP_LE64TOSCRIPTNUM,xe.OP_LE32TOLE64,xe.OP_ECMULSCALARVERIFY,xe.OP_TWEAKVERIFY,xe.OP_PUBKEYHASH,xe.OP_PUBKEY,xe.OP_INVALIDOPCODE],be=[xe.OP_INSPECTINPUTOUTPOINT,xe.OP_INSPECTINPUTASSET,xe.OP_INSPECTINPUTVALUE,xe.OP_INSPECTINPUTSCRIPTPUBKEY,xe.OP_INSPECTINPUTSEQUENCE,xe.OP_INSPECTINPUTISSUANCE,xe.OP_PUSHCURRENTINPUTINDEX,xe.OP_INSPECTOUTPUTASSET,xe.OP_INSPECTOUTPUTVALUE,xe.OP_INSPECTOUTPUTNONCE,xe.OP_INSPECTOUTPUTSCRIPTPUBKEY,xe.OP_INSPECTVERSION,xe.OP_INSPECTLOCKTIME,xe.OP_INSPECTNUMINPUTS,xe.OP_INSPECTNUMOUTPUTS];function ge(t,e){return!(e<0||e>=t.length)}function we(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return{sigs:e.reduce((function(t,e){return t.concat(e.sigs)}),[]),hasIntrospection:e.reduce((function(t,e){return t||e.hasIntrospection}),!1),needParameters:e.reduce((function(t,e){return t||e.needParameters}),!1)}}var me,Pe,Ee=function(t){return function(e){if(!ge(t,e))throw new Error("Invalid position (NEED PARAM OPCODE)");return{sigs:[],hasIntrospection:!1,needParameters:!0}}},ke=function(t){return function(e){if(!ge(t,e))throw new Error("invalid position (INTROSPECTION OPCODE)");return{sigs:[],hasIntrospection:!0,needParameters:!1}}},Te=function(t){return function(e){if(!ge(t,e))throw new Error("invalid position (CHECKSIG)");return ge(t,e-1)?{sigs:[{pubkey:t[e-1].toString("hex")}],hasIntrospection:!1,needParameters:!1}:{sigs:[],hasIntrospection:!1,needParameters:!0}}},Ae=function(t){return Buffer.of(t).toString("hex")},Oe=(new Map).set(Ae(xe.OP_CHECKSIG),Te);function Se(t){for(var r=function(t){var r,n=e.script.decompile(t);if(null===n)throw new Error("malformed script");return null!=(r=null==n?void 0:n.map((function(t){return Buffer.isBuffer(t)?t:Buffer.of(t)})))?r:[]}(Buffer.from(t,"hex")),n={sigs:[],hasIntrospection:!1,needParameters:!1},i=0;i<r.length;i++){var o=r[i].toString("hex"),a=Oe.get(o);a&&(n=we(n,a(r)(i)))}return n}be.forEach((function(t){return Oe.set(Ae(t),ke)})),ye.forEach((function(t){return Oe.set(Ae(t),Ee)})),function(t){t[t.SCRIPT=0]="SCRIPT",t[t.TREE=1]="TREE",t[t.HEX=2]="HEX",t[t.KEY=3]="KEY"}(me||(me={})),function(t){t.ELTR="eltr",t.ASM="asm",t.RAW="raw"}(Pe||(Pe={}));var Ie=(new Map).set(Pe.ELTR,2).set(Pe.ASM,1).set(Pe.RAW,1),_e=new Map([[Pe.RAW,function(t){return Ne(t,Pe.RAW),Ue(t.children[0])}],[Pe.ASM,function(t){return Ne(t,Pe.ASM),Ue(t.children[0])}]]);function Ke(t){var r,n=_e.set(Pe.ELTR,(r=e.bip341.BIP341Factory(t),function(t){if(Ne(t,Pe.ELTR),t.children[0].type!==me.KEY)throw new Error("Expected KEY as first argument of eltr");if(t.children[1].type!==me.TREE)throw new Error("Expected TREE as second argument of eltr");var n=function(t){if(t.type!==me.KEY)throw new Error("Expected key node");if("string"!=typeof t.value&&64===t.value.length)throw new Error("Expected key (64 hex chars)");return Buffer.from(t.value,"hex")}(t.children[0]),i=function t(e){if(e.type!==me.TREE)throw new Error("Expected tree node");var r=[];if(e.children.length<1||e.children.length>2)throw new Error("Expected tree node with 1 or 2 leaves");for(var n,i=T(e.children);!(n=i()).done;){var o=n.value;switch(o.type){case me.SCRIPT:r.push({scriptHex:Re(o,_e).scriptPubKey().toString("hex")});break;case me.TREE:r.push.apply(r,t(o));break;default:throw new Error("Expected tree node with children of type "+me.SCRIPT+" or "+me.TREE)}}return r}(t.children[1]),o=e.bip341.toHashTree(i,!0),a=Buffer.concat([Buffer.of(0),n]),s=r.taprootOutputScript(a,o);return{witnesses:function(t){var n=i.find((function(e){return e.scriptHex===t}));if(!n)throw new Error("Could not find leaf script for script "+t);var s=e.bip341.findScriptPath(o,e.bip341.tapLeafHash(n));return r.taprootSignScriptStack(a,n,o.hash,s)},scriptPubKey:function(){return s},taprootHashTree:o,taprootInternalKey:n.toString("hex")}}));return function(t){return Re(t,n,!0)}}function Ne(t,e){if(t.type!==me.SCRIPT)throw new Error("Expected script node");if(t.value!==e)throw new Error("Expected "+e+" script");if(t.children.length!==Ie.get(t.value))throw new Error("Expected script node "+t.type+" with "+Ie.get(t.value)+" of children")}function Ue(t){if(t.type!==me.HEX)throw new Error("Expected hex node");if("string"!=typeof t.value)throw new Error("Expected hex node with string value");var e=Buffer.from(t.value,"hex");return{scriptPubKey:function(){return e}}}var Be=[Pe.RAW,Pe.ELTR];function Re(t,e,r){void 0===r&&(r=!1);var n=e.get(t.value);if(!n)throw new Error("node type: "+t.type+" is not a descriptor");if(!r&&Be.includes(t.value))throw new Error("node type: "+t.value+" is a top level only descriptor");return n(t)}var Le=/^([A-Fa-f0-9]{2})+/;function Me(t){return function(t,e){var r=e.match(Le);return r?[r[0],e.slice(r[0].length)]:["",e]}(0,t)}var Ce=function(t,e){return new Error('Expected "'+t+'" got "'+e+'"')};function He(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){for(var r,n,i=t.trimStart(),o=T(e);!(n=o()).done;){var a=(0,n.value)(i),s=a[0],u=a[1];s&&(r?r.children.push(s):r=s),i=u.trimStart()}return[r,i]}}function De(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n=[];return function(t){for(var r,i=T(e);!(r=i()).done;){var o=r.value;try{return o(t)}catch(t){t instanceof Error&&n.push(t)}}throw new Error("one of: "+n.map((function(t){return t.message})).join(", "))}}var Fe=function(t){var e=Me(t);return[{type:me.HEX,value:e[0],children:[]},e[1]]},je=function(t){var e=Me(t),r=e[0],n=e[1];if(64!==r.length)throw Ce("key (hex string with len=64)",r);return[{type:me.KEY,value:r,children:[]},n]},We=function(t){var r=function(t,e){var r=t.indexOf(")");if(-1===r)throw new Error("Expected )");return[t.slice(0,r),t.slice(r)]}(t),n=r[1],i=e.script.fromASM(r[0]);return[{type:me.HEX,value:i.toString("hex"),children:[]},n]},Ge=function(t){return function(e){if(e.startsWith(t))return[void 0,e.slice(t.length)];throw Ce(t,e.slice(0,t.length))}},Ve=function(t){var e=Ge("{")(t);return[{type:me.TREE,value:void 0,children:[]},e[1]]},Xe=Ge("}"),qe=function t(e){return e.startsWith("{")?He(Ve,t,De(He(ze,t,Xe),Xe))(e):Ze(e)},Ye=function(t){return function(e){var r=He(Ge(function(t){return t.toString()}(t)),Ge("("))(e);return[{type:me.SCRIPT,value:t,children:[]},r[1]]}},Qe=Ge(")"),ze=Ge(","),Ze=function(t){return De(tr,$e,Je)(t)},$e=He(Ye(Pe.RAW),Fe,Qe),Je=He(Ye(Pe.ELTR),je,ze,qe,Qe),tr=He(Ye(Pe.ASM),We,Qe),er=new RegExp("[$][a-zA-Z0-9|@_.-]+","g");function rr(t){var e=Array.from(new Set(t.match(er)));return e?e.map((function(t){return t.slice(1)})):[]}function nr(t,e){return function(t,e){var r=rr(e);if(!r.length)return e;for(var n,i,o=e,a=T(r);!(n=a()).done;){var s,u=n.value,c=null==(s=t.get(u))?void 0:s.pubkey;if(!c)throw new Error("Could not find namespace context: "+u);i=c,o=o.split("$"+u).join(i)}return o}(t.namespaces,e)}Object.keys(e).forEach((function(t){"default"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return e[t]}})})),exports.BLOCKSTREAM_ESPLORA_ENDPOINT="https://blockstream.info/liquid/api",exports.BrowserInject=nt,exports.BufferMap=N,exports.DEFAULT_BASE_DERIVATION_PATH="m/48'/0'/0'/2'",exports.DEFAULT_SATS_PER_BYTE=Jt,exports.Electrs=Yt,exports.ElectrsBatchServer=Qt,exports.Identity=J,exports.MasterPublicKey=tt,exports.Mnemonic=et,exports.Multisig=ut,exports.MultisigWatchOnly=st,exports.PrivateKey=rt,exports.Wallet=ae,exports.addToTx=re,exports.analyse=Se,exports.analyzeTapscriptTree=function t(e){var r;if(!e)return{};var n=y({},e.left?t(e.left):{},e.right?t(e.right):{});return e.scriptHex?y({},n,((r={})[e.scriptHex]=Se(e.scriptHex),r)):n},exports.balances=function(t){for(var e=Q(t,$),r={},n=0,i=Object.entries(e);n<i.length;n++){var o=i[n];r[o[0]]=ce(o[1])}return r},exports.checkIdentityType=X,exports.checkMnemonic=q,exports.craftMultipleRecipientsPset=te,exports.craftSingleRecipientPset=$t,exports.createFeeOutput=ee,exports.decodePset=Y,exports.esploraTxToTxInterface=Pt,exports.estimateTxSize=ne,exports.fetchAllTxs=function(t,e,r,n){return Xt.apply(this,arguments)},exports.fetchAllUtxos=function(t,e,r,n){return qt.apply(this,arguments)},exports.fetchAndUnblindTxs=function(t,e,r,n){return It.apply(this,arguments)},exports.fetchAndUnblindTxsGenerator=Ot,exports.fetchAndUnblindUtxos=Ct,exports.fetchAndUnblindUtxosGenerator=Lt,exports.fetchTx=function(t,e){return bt.apply(this,arguments)},exports.fetchTxHex=xt,exports.fetchUtxos=gt,exports.fromAssetHash=function(t){return Buffer.concat([Buffer.from("01","hex"),Buffer.from(t,"hex").reverse()])},exports.fromXpub=function(t,e){return B(t,"liquid"===e?"zpub":"vpub")},exports.getAsset=$,exports.getIndexFromAddress=function(t){if(!t.derivationPath)throw new Error("need derivation path to be defined");var e=t.derivationPath.split("/");return parseInt(e[e.length-1])},exports.getNetwork=W,exports.getSats=Z,exports.getScripts=function(t){return new Set(t.map((function(t){return e.address.toOutputScript(t.confidentialAddress).toString("hex")})))},exports.getUnblindURLFromTx=function(t,e){for(var r,n=[],i=function(t){return Buffer.from(t,"hex").reverse().toString("hex")},o=T(t.vout);!(r=o()).done;){var a=r.value;a.prevout.script.length>0&&z(a)&&n.push({value:Z(a),asset:$(a),assetBlinder:i(a.unblindData.assetBlindingFactor.toString("hex")),valueBlinder:i(a.unblindData.valueBlindingFactor.toString("hex"))})}return Tt(e,t.txid,n)},exports.greedyCoinSelector=function(t){return void 0===t&&(t=vt),function(e){void 0===e&&(e=ct);var r,n=(r=t,function(t){return function(e){return function(n){var i=[],o=function(t){return function(e){return function(r){return function(n){return function(i){var o=0,a=i.filter(ft(r)).sort(t).reduce((function(t,e){return o<=n&&(t.push(e),o+=Z(e)),t}),[]);return o<n&&e(r,n,o),a}}}}}(r)(t);return n.forEach((function(t,e){i.push(o(e)(t))})),i.flatMap((function(t){return t(e)}))}}})(e);return function(t,e,r){var i=function(t){return function(e){return function(r){var n=[];return e.forEach((function(e,i){var o,a=(o=r,function(t){var e=function(t){return function(e){return e.filter(ft(t)).reduce((function(t,e){return t+Z(e)}),0)}}(t)(o);return function(t){return e-t}})(i)(e);a>0&&n.push({address:t(i),asset:i,value:a})})),n}}}(r),o=function(t){for(var e,r=T(t);!(e=r()).done;){var n=e.value;if("number"!=typeof n.value&&(n.value=parseInt(n.value),"number"!=typeof n.value))throw new Error("invalid '"+typeof n.value+"' type for recipient.value")}return t.reduce(pt,new Map)}(e),a=n(t)(o);return{selectedUtxos:a,changeOutputs:i(o)(a)}}}},exports.groupBy=Q,exports.inputBlindingDataMap=function(t,e){for(var r,n=new Map,i=-1,o=function(){var t=r.value;i++;var o=e.find((function(e){return(r=e.txid,Buffer.from(r,"hex").reverse()).equals(t.hash)&&e.vout===t.index;var r}));o&&o.unblindData&&K(o.prevout)&&n.set(i,o.unblindData)},a=T(j(t).ins);!(r=a()).done;)o();return n},exports.isConfidentialOutput=K,exports.isUnblindedOutput=z,exports.isValidAmount=function(t){return!(t<=0||!Number.isSafeInteger(t))},exports.isValidExtendedBlindKey=D,exports.isValidXpub=H,exports.makeEvaluateDescriptor=function(t){var e=function(t){return{compile:Ke(t)}}(t).compile;return function(t,r){var n=nr(t,r),i=Ze(n)[0];if(!i)throw new Error("Failed to parse template");return e(i)}},exports.makeUnblindURL=Tt,exports.masterPubKeyRestorerFromEsplora=function(t){return le(t,(function(e,r){return t.getAddress(e,r).address.confidentialAddress}))},exports.masterPubKeyRestorerFromState=function(t){return ve(t)},exports.mnemonicRestorerFromChain=function(t){return e=t,r=function(e,r){return t.getAddress(e,r).address.confidentialAddress},function(){var t=x(O.mark((function t(n){var i,o,a,s,u,c,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.gapLimit,o=n.api,s=(a=function(){var t=x(O.mark((function t(e){var r,n,a,s,u;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0,n=0,a=void 0,s=O.mark((function t(){var s,u,c,p,f;return O.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=n,t.next=3,Promise.all(Array.from(Array(i).keys()).map((function(t){return t+s})).map(e));case 3:return u=t.sent,t.next=6,o.addressesHasBeenUsed(u);case 6:c=0,p=T(t.sent);case 9:if((f=p()).done){t.next=22;break}if(!f.value){t.next=16;break}a=c+n,r=0,t.next=19;break;case 16:if(++r!==i){t.next=19;break}return t.abrupt("return",{v:a});case 19:c++;case 20:t.next=9;break;case 22:n+=i;case 23:case"end":return t.stop()}}),t)}));case 4:if(!(r<i)){t.next=11;break}return t.delegateYield(s(),"t0",6);case 6:if("object"!=typeof(u=t.t0)){t.next=9;break}return t.abrupt("return",u.v);case 9:t.next=4;break;case 11:return t.abrupt("return",a);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())((function(t){return Promise.resolve(r(!1,t))})),u=a((function(t){return Promise.resolve(r(!0,t))})),t.next=6,Promise.all([s,u]);case 6:return p=(c=t.sent)[0],f=c[1],t.abrupt("return",ve(e)({lastUsedExternalIndex:p,lastUsedInternalIndex:f}));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var e,r},exports.mnemonicRestorerFromEsplora=function(t){return le(t,(function(e,r){return t.getAddress(e,r).address.confidentialAddress}))},exports.mnemonicRestorerFromState=function(t){return ve(t)},exports.multisigFromEsplora=function(t){return le(t,(function(e,r){return t.getMultisigAddress(e?st.INTERNAL_INDEX:st.EXTERNAL_INDEX,r).confidentialAddress}))},exports.multisigWatchOnlyFromEsplora=function(t){return le(t,(function(e,r){return t.getMultisigAddress(e?st.INTERNAL_INDEX:st.EXTERNAL_INDEX,r).confidentialAddress}))},exports.outputBlindingPubkeysMap=function(t,r){for(var n,i=new Map,o=T(r);!(n=o()).done;){var a=n.value,s=pe(t,a);-1!==s&&fe(a)&&i.set(s,e.address.fromConfidential(a).blindingKey)}return i},exports.privateBlindKeyGetter=function(t){return function(){var e=x(O.mark((function e(r){return O.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.getBlindingPrivateKey(r));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},exports.psetToUnsignedHex=F,exports.psetToUnsignedTx=j,exports.restorerFromEsplora=le,exports.restorerFromState=ve,exports.toAssetHash=function(t){return t.slice(1).reverse().toString("hex")},exports.toNumber=function(t){return e.confidential.confidentialValueToSatoshi(t)},exports.toOutpoint=function(t){return{txid:t.txid,vout:t.vout}},exports.toXpub=R,exports.tryToUnblindUtxo=Dt,exports.txsFetchGenerator=Gt,exports.unblindOutput=G,exports.unblindTransaction=Nt,exports.utxosFetchGenerator=jt,exports.utxosFromTransactions=function(t,e,r){void 0===r&&(r=[]);var n=function(t){return t||Infinity};return t.sort((function(t,e){return function(t,e){return n(t.status.blockHeight)-n(e.status.blockHeight)||0}(t,e)||function(t,e){return t.vin.map((function(t){return t.txid})).includes(e.txid)?1:-1}(t,e)})).reduce((function(t,r,n){return function(t,e,r){var n=e.vout.filter((function(t){return r.has(t.prevout.script.toString("hex"))}));return t.concat(n)}(function(t,e){for(var r,n=t,i=function(){var t=r.value;n=n.filter((function(e){return!(e.txid===t.txid&&e.vout===t.vout)}))},o=T(e);!(r=o()).done;)i();return n}(t,r.vin),r,e)}),r)},exports.validate=function(t){var e=rr(t);if(e.length>0){for(var r,n=Buffer.alloc(32).toString("hex"),i={namespaces:new Map},o=T(e);!(r=o()).done;)i.namespaces.set(r.value,{pubkey:n});t=nr(i,t)}try{return!!Ze(t)[0]}catch(t){return!1}},exports.walletFromAddresses=function(t,e,r,n){return se.apply(this,arguments)},exports.walletFromCoins=ue;
//# sourceMappingURL=ldk.cjs.production.min.js.map
